---
title: "Test 14: Z-test for Two Correlation Coefficients"
output:
  word_document:
    highlight: "default"
    reference_docx: word_styles.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Step_1, warning=FALSE, message=FALSE}
# Load Required Functions:
source(file = "muFunc.R")

# Load Required Packages:
wants <- c("dplyr", "psych", "pacman", "ggplot2",
           "PerformanceAnalytics", "miscor", "cocor")
has <- wants %in% rownames(x = installed.packages())
if(any(!has)) install.packages(wants[!has])
pacman::p_load(char = wants)

# Load Required Data:
data <- read.csv(file = "data/Data_Test_23.csv", header = TRUE)

# Show Data:
headTail(x = data)
```

```{r Step_2, fig.width=4, fig.height=4, dpi=600}
# Assumption Checking:
# 1. The x and y Values Originate from Normal Distributions.

# Mashhad
# Use Shapiro-Wilk Normality Test:
shapiro.test(x = data$Mashhad_T)
shapiro.test(x = data$Mashhad_SSH)

# Normality Plot:
ggqqplot(data = data$Mashhad_T, ylab = "Mashhad Temp. (C)")
ggqqplot(data = data$Mashhad_SSH, ylab = "Mashhad Sunshine (h)")


# Sabzevar
# Use Shapiro-Wilk Normality Test:
shapiro.test(x = data$Sabzevar_T)
shapiro.test(x = data$Sabzevar_SSH)

# Normality Plot:
ggqqplot(data = data$Sabzevar_T, ylab = "Sabzevar Temp. (C)")
ggqqplot(data = data$Sabzevar_SSH, ylab = "Sabzevar Sunshine (h)")

# 2. The Relationships Are Linear.

# Mashhad
# Visualize Data Using Scatter Plots:
ggscatter(data = data, x = "Mashhad_T", y = "Mashhad_SSH", add = "reg.line",
          conf.int = TRUE, xlab = "Temp. (C)", ylab = "Sunshine (h)")

# Sabzavar
# Visualize Data Using Scatter Plots:
ggscatter(data = data, x = "Sabzevar_T", y = "Sabzevar_SSH", add = "reg.line",
          conf.int = TRUE, xlab = "Temp. (C)", ylab = "Sunshine (h)")
```

```{r Step_3}
# Method 1:---------------------------------------------------------------------
# Two-way Table
(result = table(data$Before, data$After))

# Number of People
N = sum(result)

# Test Statistic
a = result[2,2]
b = result[1,2]
c = result[2,1]
d = result[1,1]

sigma = sqrt(((b + c) - (((b - c) ^ 2) / N)) / (N * (N - 1)))

Z = (b - c) / (N * sigma)

# Compute the critical values at 0.05 significance level (two tailed).
alpha = 0.05
z.half.alpha = round(x = qnorm(p = (1 - alpha/2)), digits = 4)

# P-value for Spearman's rank correlation coefficient (Two Tailed).
p_value = 2 âˆ— (1 - pnorm(q = Z))

cat("z-score: ", Z, "\n")
cat("Critical values: ", c(-z.half.alpha, z.half.alpha), "\n")
cat("P-value: ", p_value, "\n")

plotDistStat(dist = "Normal",
             to = 3,
             alpha_level = 0.05,
             statistic_point = Z,
             p_value = p_value)

# Method 2:---------------------------------------------------------------------


```

